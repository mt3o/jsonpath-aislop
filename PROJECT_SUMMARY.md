# jsonpath-rewritten - Project Summary

## Overview

A modern, zero-dependency TypeScript rewrite of the jsonpath library with a focus on simplicity and maintainability.

## Project Structure

```
jsonpath2/
├── src/
│   ├── index.ts          # Main entry point with exports
│   ├── types.ts          # TypeScript interfaces and types
│   ├── parser.ts         # Tokenizes JSONPath expressions
│   ├── evaluator.ts      # Evaluates tokens against JSON objects
│   ├── jsonpath.ts       # Main API implementation
│   ├── examples.ts       # Usage examples (not included in build)
│   └── test.ts           # Test cases (not included in build)
├── dist/                 # Compiled output (generated by build)
├── package.json          # NPM package configuration
├── tsconfig.json         # TypeScript compiler configuration
├── README.md             # Main documentation
├── QUICK_REFERENCE.md    # Quick reference guide
├── CONTRIBUTING.md       # Contribution guidelines
├── CHANGELOG.md          # Version history
├── LICENSE               # MIT License
└── .gitignore           # Git ignore rules
```

## Core Architecture

### 1. Parser (`parser.ts`)
- Tokenizes JSONPath expression strings into an array of tokens
- Each token represents an operation (property access, array index, filter, etc.)
- Simple character-by-character parsing with minimal complexity

### 2. Evaluator (`evaluator.ts`)
- Takes tokens and a JSON object
- Processes each token sequentially
- Returns array of `{path, value}` results
- Handles all JSONPath operations (wildcards, slices, filters, recursive descent)

### 3. API Layer (`jsonpath.ts`)
- Provides user-facing functions: `query()`, `value()`, `paths()`, `nodes()`
- Coordinates parsing and evaluation
- Formats results based on user needs

## Supported JSONPath Features

✅ Root operator (`$`)
✅ Child operator (`.property`, `['property']`)
✅ Wildcard (`*`)
✅ Recursive descent (`..`)
✅ Array indices (`[0]`, `[-1]`)
✅ Array slices (`[start:end:step]`)
✅ Union operator (`[0,1,2]`, `['a','b']`)
✅ Filter expressions (`[?(@.price < 10)]`)

## Design Principles

1. **Simplicity**: Naive, straightforward implementations
2. **Readability**: Code is easy to understand and maintain
3. **Type Safety**: Full TypeScript types throughout
4. **Zero Dependencies**: No external packages required
5. **Modularity**: Clear separation of concerns

## Usage

```typescript
import { query, value, paths, nodes } from 'jsonpath-rewritten';

const data = { store: { book: [/* ... */] } };

// Get all book titles
const titles = query(data, '$.store.book[*].title');

// Get first book price
const price = value(data, '$.store.book[0].price');

// Get paths to all prices
const pricePaths = paths(data, '$..price');

// Get nodes with both paths and values
const bookNodes = nodes(data, '$.store.book[*]');
```

## Build

```bash
npm install
npm run build
```

Outputs to `dist/` folder:
- `index.js` - Compiled JavaScript (ES modules)
- `index.d.ts` - TypeScript type definitions
- `*.js.map` - Source maps

## Key Implementation Details

### Token Types
- `root`, `dot`, `dotdot` - Navigation operators
- `star` - Wildcard
- `identifier` - Property name
- `index` - Array index
- `slice` - Array slice
- `union` - Multiple selections
- `filter` - Filter expression

### Evaluation Strategy
1. Start with root result: `[{path: [], value: rootObject}]`
2. For each token, transform current results into next results
3. Each token operation can produce 0, 1, or many results
4. Final results contain all matching paths and values

### Filter Expression Evaluation
- Simplified JavaScript evaluation using `Function` constructor
- Supports basic property access (`@.property`)
- Supports comparison operators (`<`, `>`, `==`, etc.)
- Safe fallback: returns false on evaluation errors

## Testing

Tests use Node.js's built-in `assert` module:

```bash
npm test
```

The test suite (`src/test.ts`) includes comprehensive tests covering:
- Property access (dot notation, bracket notation)
- Array operations (indexing, negative indices, slicing, unions)
- Wildcard and recursive descent
- Filter expressions
- Path and node queries
- Edge cases (nonexistent paths, empty results)

All tests use `assert.strictEqual()` and `assert.deepStrictEqual()` for proper validation.

## Key Implementation Details

- More robust filter expression parser
- Performance optimizations for large datasets
- Additional utility functions
- Comprehensive test suite with test runner
- CommonJS bundle generation

## License

MIT License - See LICENSE file for details

---

**Built with ❤️ using TypeScript**
